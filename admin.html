<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/Sweet_Delight_icon.png" type="image/png">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Sweet Delights · Admin Dashboard</title>
    <style>
        /* Admin Login Styles */
        .admin-login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #3d7a52 100%);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .admin-login-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .admin-login-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            padding: 40px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            animation: loginSlideIn 0.6s ease-out;
        }
        
        @keyframes loginSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .admin-login-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .admin-login-header img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 16px;
        }
        
        .admin-login-header h1 {
            color: #1a472a;
            font-size: 1.8rem;
            margin: 0 0 8px;
        }
        
        .admin-login-header p {
            color: #666;
            font-size: 0.95rem;
            margin: 0;
        }
        
        .admin-login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .admin-login-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .admin-login-field label {
            font-weight: 600;
            color: #1a472a;
            font-size: 0.9rem;
        }
        
        .admin-login-field input {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: #fafafa;
        }
        
        .admin-login-field input:focus {
            outline: none;
            border-color: #3d7a52;
            box-shadow: 0 0 0 4px rgba(61, 122, 82, 0.15);
            background: #fff;
        }
        
        .admin-login-btn {
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #3d7a52 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 8px;
        }
        
        .admin-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(26, 71, 42, 0.35);
        }
        
        .admin-login-btn:active {
            transform: translateY(0);
        }
        
        .admin-login-error {
            color: #dc3545;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 12px;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            display: none;
        }
        
        .admin-login-error.show {
            display: block;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
        
        .admin-demo-credentials {
            margin-top: 28px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(61, 122, 82, 0.08), rgba(26, 71, 42, 0.12));
            border-radius: 12px;
            border: 1px dashed rgba(61, 122, 82, 0.3);
        }
        
        .admin-demo-credentials h3 {
            color: #1a472a;
            font-size: 0.95rem;
            margin: 0 0 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-demo-credentials h3 i {
            color: #3d7a52;
        }
        
        .admin-demo-credentials .credential-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }
        
        .admin-demo-credentials .credential-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .admin-demo-credentials .credential-label {
            color: #666;
            font-size: 0.85rem;
        }
        
        .admin-demo-credentials .credential-value {
            font-family: 'Courier New', monospace;
            color: #1a472a;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.7);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .admin-demo-credentials .demo-note {
            margin-top: 12px;
            font-size: 0.8rem;
            color: #888;
            text-align: center;
        }
        
        .admin-back-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .admin-back-link a {
            color: #3d7a52;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }
        
        .admin-back-link a:hover {
            color: #1a472a;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- ========== Admin Login Overlay ========== -->
    <div class="admin-login-overlay" id="admin-login-overlay">
        <div class="admin-login-card">
            <div class="admin-login-header">
                <img src="assets/Sweet_Delight_icon.png" alt="Sweet Delights Logo">
                <h1>Admin Portal</h1>
                <p>Sign in to manage your bakery dashboard</p>
            </div>
            <form class="admin-login-form" id="admin-login-form" onsubmit="return handleAdminLogin(event)">
                <div class="admin-login-error" id="admin-login-error">
                    <i class="fa-solid fa-circle-exclamation"></i>
                    Invalid credentials. Please try again.
                </div>
                <div class="admin-login-field">
                    <label for="admin-username">Username</label>
                    <input type="text" id="admin-username" placeholder="Enter your username" autocomplete="username" required>
                </div>
                <div class="admin-login-field">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" placeholder="Enter your password" autocomplete="current-password" required>
                </div>
                <button type="submit" class="admin-login-btn">
                    <i class="fa-solid fa-right-to-bracket"></i>
                    Sign In to Dashboard
                </button>
            </form>
            <div class="admin-demo-credentials">
                <h3><i class="fa-solid fa-key"></i> Demo Access Credentials</h3>
                <div class="credential-row">
                    <span class="credential-label">Username:</span>
                    <span class="credential-value">admin</span>
                </div>
                <div class="credential-row">
                    <span class="credential-label">Password:</span>
                    <span class="credential-value">demo123</span>
                </div>
                <p class="demo-note">Use these credentials to explore the admin dashboard</p>
            </div>
            <div class="admin-back-link">
                <a href="index.html"><i class="fa-solid fa-arrow-left"></i> Back to Store</a>
            </div>
        </div>
    </div>
    
    <script>
        // Admin Authentication
        const DEMO_CREDENTIALS = {
            username: 'admin',
            password: 'demo123'
        };
        
        function handleAdminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('admin-username').value.trim();
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('admin-login-error');
            const overlay = document.getElementById('admin-login-overlay');
            
            if (username === DEMO_CREDENTIALS.username && password === DEMO_CREDENTIALS.password) {
                // Success - hide login, show dashboard
                errorEl.classList.remove('show');
                overlay.classList.add('hidden');
                sessionStorage.setItem('adminLoggedIn', 'true');
            } else {
                // Show error
                errorEl.classList.add('show');
                document.getElementById('admin-password').value = '';
                setTimeout(() => {
                    errorEl.classList.remove('show');
                }, 3000);
            }
            
            return false;
        }
        
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('admin-login-overlay').classList.add('hidden');
            }
        });
        
        // Logout function (can be called from dashboard)
        function adminLogout() {
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('admin-login-overlay').classList.remove('hidden');
            document.getElementById('admin-login-form').reset();
        }
    </script>

    <!-- ========== Admin Header ========== -->
    <header class="admin-header">
        <a class="brand" href="index.html">
            <img src="assets/Sweet_Delight_icon.png" alt="Sweet Delights logo">
            <span>
                Sweet Delights
                <small>Admin Dashboard</small>
            </span>
        </a>
        <div class="header-actions">
            <a class="button-secondary button" href="index.html" target="_blank" rel="noopener">
                <i class="fa-solid fa-arrow-up-right-from-square" aria-hidden="true"></i>
                View Storefront
            </a>
            <button class="button" type="button" id="refresh-data">
                <i class="fa-solid fa-arrows-rotate" aria-hidden="true"></i>
                Refresh
            </button>
            <button class="button" type="button" id="export-orders">
                <i class="fa-solid fa-file-arrow-down" aria-hidden="true"></i>
                Export CSV
            </button>
            <button class="button button-danger" type="button" id="clear-orders">
                <i class="fa-solid fa-trash-can" aria-hidden="true"></i>
                Clear Orders
            </button>
            <button class="button button-logout" type="button" onclick="adminLogout()" title="Sign Out">
                <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i>
                Logout
            </button>
        </div>
    </header>

    <!-- ========== Main Content ========== -->
    <main class="admin-main">
        
        <!-- ========== Key Metrics Dashboard ========== -->
        <section class="metric-grid fade-in">
            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Total Orders</span>
                        <span class="metric-value" data-metric="orders">0</span>
                    </div>
                    <div class="metric-icon metric-icon--primary">
                        <i class="fa-solid fa-cart-shopping"></i>
                    </div>
                </div>
                <span class="metric-change metric-change--neutral" data-metric="orders-change">
                    <i class="fa-solid fa-minus"></i> No change
                </span>
                <span class="metric-footnote">All time orders</span>
            </article>

            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Open Queue</span>
                        <span class="metric-value" data-metric="open">0</span>
                    </div>
                    <div class="metric-icon metric-icon--warning">
                        <i class="fa-solid fa-clock"></i>
                    </div>
                </div>
                <span class="metric-change metric-change--neutral" data-metric="open-change">
                    <i class="fa-solid fa-minus"></i> No change
                </span>
                <span class="metric-footnote">Pending fulfillment</span>
            </article>

            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Revenue</span>
                        <span class="metric-value" data-metric="revenue">₹0.00</span>
                    </div>
                    <div class="metric-icon metric-icon--success">
                        <i class="fa-solid fa-indian-rupee-sign"></i>
                    </div>
                </div>
                <span class="metric-change metric-change--positive" data-metric="revenue-change">
                    <i class="fa-solid fa-arrow-up"></i> +0%
                </span>
                <span class="metric-footnote">Total captured</span>
            </article>

            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Average Order</span>
                        <span class="metric-value" data-metric="average">₹0.00</span>
                    </div>
                    <div class="metric-icon metric-icon--info">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                </div>
                <span class="metric-change metric-change--neutral" data-metric="average-change">
                    <i class="fa-solid fa-minus"></i> No change
                </span>
                <span class="metric-footnote">Per order value</span>
            </article>

            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Top Seller</span>
                        <span class="metric-value" data-metric="top-seller" style="font-size: 1.2rem;">—</span>
                    </div>
                    <div class="metric-icon metric-icon--primary">
                        <i class="fa-solid fa-trophy"></i>
                    </div>
                </div>
                <span class="metric-footnote">Most ordered item</span>
            </article>

            <article class="metric-card">
                <div class="metric-header">
                    <div>
                        <span class="metric-label">Today's Orders</span>
                        <span class="metric-value" data-metric="today">0</span>
                    </div>
                    <div class="metric-icon metric-icon--success">
                        <i class="fa-solid fa-calendar-day"></i>
                    </div>
                </div>
                <span class="metric-change metric-change--positive" data-metric="today-change">
                    <i class="fa-solid fa-arrow-up"></i> Active
                </span>
                <span class="metric-footnote">Received today</span>
            </article>
        </section>

        <!-- ========== Sales Analytics Chart ========== -->
        <section class="analytics-section fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-chart-column"></i>
                    Sales Analytics
                    <span class="section-badge">Live</span>
                </h2>
                <div class="section-actions">
                    <select id="chart-period" class="button">
                        <option value="7">Last 7 Days</option>
                        <option value="14">Last 14 Days</option>
                        <option value="30">Last 30 Days</option>
                    </select>
                </div>
            </div>
            <div class="chart-container" id="sales-chart">
                <div class="chart-placeholder">
                    <i class="fa-solid fa-chart-simple"></i>
                    <p>Sales data will appear here</p>
                </div>
            </div>
        </section>

        <!-- ========== Statistics Grid ========== -->
        <section class="analytics-section fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-table-cells"></i>
                    Quick Statistics
                </h2>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Delivered Orders</span>
                    <span class="stat-value" data-metric="delivered">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">In Progress</span>
                    <span class="stat-value" data-metric="in-progress">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Products Sold</span>
                    <span class="stat-value" data-metric="products-sold">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg. Fulfillment Time</span>
                    <span class="stat-value" data-metric="fulfillment-time">—</span>
                </div>
            </div>
        </section>

        <!-- ========== Quick Actions ========== -->
        <section class="quick-actions fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-bolt"></i>
                    Quick Actions
                </h2>
            </div>
            <div class="action-grid">
                <div class="action-card" onclick="document.getElementById('admin-search').focus()">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <span class="action-title">Search Orders</span>
                </div>
                <div class="action-card" onclick="filterByStatus('Pending')">
                    <i class="fa-solid fa-filter"></i>
                    <span class="action-title">View Pending</span>
                </div>
                <div class="action-card" onclick="document.getElementById('export-orders').click()">
                    <i class="fa-solid fa-download"></i>
                    <span class="action-title">Export Data</span>
                </div>
                <div class="action-card" onclick="document.getElementById('refresh-data').click()">
                    <i class="fa-solid fa-sync"></i>
                    <span class="action-title">Refresh Data</span>
                </div>
            </div>
        </section>

        <!-- ========== Control Panel & Filters ========== -->
        <section class="control-panel fade-in">
            <div class="form-field">
                <label class="field-label" for="admin-search">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    Search Orders
                </label>
                <input type="search" id="admin-search" placeholder="Search by ID, phone, address or item..." autocomplete="off">
            </div>
            
            <div class="form-field">
                <span class="field-label">
                    <i class="fa-solid fa-filter"></i>
                    Status Filter
                </span>
                <div class="chip-group">
                    <button type="button" class="chip chip--active" data-status-filter="all">All</button>
                    <button type="button" class="chip" data-status-filter="Pending">Pending</button>
                    <button type="button" class="chip" data-status-filter="Preparing">Preparing</button>
                    <button type="button" class="chip" data-status-filter="Ready">Ready</button>
                    <button type="button" class="chip" data-status-filter="Out for Delivery">Delivering</button>
                    <button type="button" class="chip" data-status-filter="Delivered">Delivered</button>
                </div>
            </div>
            
            <div class="form-field">
                <label class="field-label" for="date-filter">
                    <i class="fa-solid fa-calendar"></i>
                    Date Range
                </label>
                <select id="date-filter">
                    <option value="all">All Dates</option>
                    <option value="today">Today</option>
                    <option value="7">Last 7 Days</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                </select>
            </div>
            
            <div class="form-field">
                <label class="field-label">
                    <i class="fa-solid fa-star"></i>
                    High Value Orders
                </label>
                <div class="toggle-field">
                    <input type="checkbox" id="high-value-toggle">
                    <span>Show orders ≥ ₹1,200</span>
                </div>
            </div>
        </section>

        <!-- ========== Orders Section ========== -->
        <section class="orders-section fade-in">
            <div class="orders-header">
                <div>
                    <h2>Order Queue</h2>
                    <p class="help-text">Incoming orders sync from the storefront checkout in real-time.</p>
                </div>
                <span class="order-count" id="order-count">0 orders</span>
            </div>
            <div class="order-list order-list--empty" id="order-list">
                <div class="empty-state">
                    <i class="fa-solid fa-cookie-bite" aria-hidden="true"></i>
                    <p>No orders to display</p>
                    <p class="hint">Orders will appear here when customers place them from the storefront.</p>
                </div>
            </div>
        </section>

        <!-- ========== Dashboard Section (Charts) ========== -->
        <section class="dashboard-section fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-chart-pie"></i>
                    Dashboard Analytics
                    <span class="section-badge">New</span>
                </h2>
            </div>
            <div class="dashboard-grid">
                <!-- Chart 1: Revenue Trends -->
                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Revenue Trends</h3>
                        <select class="chart-filter">
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-placeholder">
                            <i class="fa-solid fa-chart-line"></i>
                            <p>Revenue chart will be rendered here</p>
                            <small>Add Chart.js or your preferred charting library</small>
                        </div>
                    </div>
                </div>

                <!-- Chart 2: Product Performance -->
                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Product Performance</h3>
                        <button class="button-link">View Details</button>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-placeholder">
                            <i class="fa-solid fa-chart-bar"></i>
                            <p>Product performance chart</p>
                            <small>Visualize best-selling products</small>
                        </div>
                    </div>
                </div>

                <!-- Chart 3: Order Status Distribution -->
                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Order Status</h3>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-placeholder">
                            <i class="fa-solid fa-chart-pie"></i>
                            <p>Order status distribution</p>
                            <small>Pie/Donut chart for order statuses</small>
                        </div>
                    </div>
                </div>

                <!-- Chart 4: Customer Activity -->
                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Customer Activity</h3>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-placeholder">
                            <i class="fa-solid fa-users"></i>
                            <p>Customer activity heatmap</p>
                            <small>Track peak ordering times</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== Inventory Management ========== -->
        <section class="inventory-section fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-boxes-stacked"></i>
                    Inventory Management
                    <span class="section-badge">New</span>
                </h2>
                <button class="button" id="add-inventory-item">
                    <i class="fa-solid fa-plus"></i>
                    Add Item
                </button>
            </div>
            <div class="inventory-grid">
                <!-- Sample Inventory Items -->
                <div class="inventory-card">
                    <div class="inventory-header">
                        <span class="inventory-name">Chocolate Cake</span>
                        <span class="inventory-status status-in-stock">In Stock</span>
                    </div>
                    <div class="inventory-details">
                        <div class="inventory-stat">
                            <span class="label">Available</span>
                            <span class="value">45 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Reorder Level</span>
                            <span class="value">10 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Last Updated</span>
                            <span class="value">2 hours ago</span>
                        </div>
                    </div>
                    <div class="inventory-actions">
                        <button class="button-link">Update Stock</button>
                        <button class="button-link">View History</button>
                    </div>
                </div>

                <div class="inventory-card">
                    <div class="inventory-header">
                        <span class="inventory-name">Croissants</span>
                        <span class="inventory-status status-low-stock">Low Stock</span>
                    </div>
                    <div class="inventory-details">
                        <div class="inventory-stat">
                            <span class="label">Available</span>
                            <span class="value">8 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Reorder Level</span>
                            <span class="value">15 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Last Updated</span>
                            <span class="value">30 minutes ago</span>
                        </div>
                    </div>
                    <div class="inventory-actions">
                        <button class="button-link alert">Reorder Now</button>
                        <button class="button-link">View History</button>
                    </div>
                </div>

                <div class="inventory-card">
                    <div class="inventory-header">
                        <span class="inventory-name">Vanilla Cupcakes</span>
                        <span class="inventory-status status-in-stock">In Stock</span>
                    </div>
                    <div class="inventory-details">
                        <div class="inventory-stat">
                            <span class="label">Available</span>
                            <span class="value">120 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Reorder Level</span>
                            <span class="value">20 units</span>
                        </div>
                        <div class="inventory-stat">
                            <span class="label">Last Updated</span>
                            <span class="value">Just now</span>
                        </div>
                    </div>
                    <div class="inventory-actions">
                        <button class="button-link">Update Stock</button>
                        <button class="button-link">View History</button>
                    </div>
                </div>

                <!-- Placeholder for more items -->
                <div class="inventory-card inventory-card-add">
                    <div class="add-placeholder">
                        <i class="fa-solid fa-plus-circle"></i>
                        <p>Add more inventory items</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== Customer Insights ========== -->
        <section class="customer-insights fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-users-viewfinder"></i>
                    Customer Insights
                    <span class="section-badge">New</span>
                </h2>
                <div class="section-actions">
                    <button class="button-link">Export Report</button>
                </div>
            </div>
            
            <div class="insights-grid">
                <!-- Customer Stats -->
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fa-solid fa-user-group"></i>
                    </div>
                    <div class="insight-content">
                        <span class="insight-label">Total Customers</span>
                        <span class="insight-value" data-metric="total-customers">0</span>
                        <span class="insight-subtext">All time registrations</span>
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fa-solid fa-repeat"></i>
                    </div>
                    <div class="insight-content">
                        <span class="insight-label">Repeat Customers</span>
                        <span class="insight-value" data-metric="repeat-customers">0</span>
                        <span class="insight-subtext">Multiple orders</span>
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fa-solid fa-star"></i>
                    </div>
                    <div class="insight-content">
                        <span class="insight-label">Avg. Customer Value</span>
                        <span class="insight-value" data-metric="customer-ltv">₹0.00</span>
                        <span class="insight-subtext">Lifetime value</span>
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fa-solid fa-trophy"></i>
                    </div>
                    <div class="insight-content">
                        <span class="insight-label">Top Customer</span>
                        <span class="insight-value" data-metric="top-customer" style="font-size: 1rem;">—</span>
                        <span class="insight-subtext">Highest orders</span>
                    </div>
                </div>
            </div>

            <!-- Recent Customers Table -->
            <div class="customer-table-wrapper">
                <h3>Recent Customers</h3>
                <table class="customer-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Phone</th>
                            <th>Orders</th>
                            <th>Total Spent</th>
                            <th>Last Order</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="customer-table-body">
                        <tr>
                            <td colspan="6" class="empty-row">
                                <i class="fa-solid fa-users"></i>
                                <p>Customer data will appear here</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

          <!-- ========== Notifications & Alerts ========== -->
        <section class="notifications-section fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-bell"></i>
                    Notifications & Alerts
                    <span class="section-badge section-badge--pulse">3</span>
                </h2>
                <div class="section-actions">
                    <button class="button-link" id="mark-all-read">
                        <i class="fa-solid fa-check-double"></i>
                        Mark All Read
                    </button>
                    <button class="button-link" id="notification-settings">
                        <i class="fa-solid fa-gear"></i>
                        Settings
                    </button>
                </div>
            </div>
            <div class="notifications-grid">
                <!-- Critical Alerts -->
                <div class="notification-card notification-card--critical">
                    <div class="notification-icon">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">Critical Stock Alert</span>
                            <span class="notification-time">5 min ago</span>
                        </div>
                        <p class="notification-message">Croissants stock is critically low (8 units remaining). Reorder immediately to avoid stockout.</p>
                        <div class="notification-actions">
                            <button class="notification-btn notification-btn--primary">Reorder Now</button>
                            <button class="notification-btn">View Details</button>
                            <button class="notification-btn notification-btn--ghost">Dismiss</button>
                        </div>
                    </div>
                </div>

                <!-- Warning Alerts -->
                <div class="notification-card notification-card--warning">
                    <div class="notification-icon">
                        <i class="fa-solid fa-clock"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">Pending Orders Alert</span>
                            <span class="notification-time">15 min ago</span>
                        </div>
                        <p class="notification-message">You have 8 orders in "Pending" status for more than 30 minutes. Please review and update.</p>
                        <div class="notification-actions">
                            <button class="notification-btn notification-btn--primary" onclick="filterByStatus('Pending')">View Pending</button>
                            <button class="notification-btn notification-btn--ghost">Dismiss</button>
                        </div>
                    </div>
                </div>

                <!-- Success Alerts -->
                <div class="notification-card notification-card--success">
                    <div class="notification-icon">
                        <i class="fa-solid fa-trophy"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">Daily Target Achieved</span>
                            <span class="notification-time">1 hour ago</span>
                        </div>
                        <p class="notification-message">Congratulations! Today's revenue target of ₹15,000 has been achieved. Current revenue: ₹16,240.</p>
                        <div class="notification-actions">
                            <button class="notification-btn notification-btn--ghost">Dismiss</button>
                        </div>
                    </div>
                </div>

                <!-- Info Alerts -->
                <div class="notification-card notification-card--info">
                    <div class="notification-icon">
                        <i class="fa-solid fa-info-circle"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">New Customer Review</span>
                            <span class="notification-time">2 hours ago</span>
                        </div>
                        <p class="notification-message">A customer left a 5-star review for Chocolate Cake. View and respond to build customer relationships.</p>
                        <div class="notification-actions">
                            <button class="notification-btn notification-btn--primary">View Review</button>
                            <button class="notification-btn notification-btn--ghost">Dismiss</button>
                        </div>
                    </div>
                </div>

                <!-- System Alerts -->
                <div class="notification-card notification-card--default">
                    <div class="notification-icon">
                        <i class="fa-solid fa-sync"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">System Update Available</span>
                            <span class="notification-time">5 hours ago</span>
                        </div>
                        <p class="notification-message">A new version of the admin dashboard is available with improved analytics and performance.</p>
                        <div class="notification-actions">
                            <button class="notification-btn notification-btn--primary">Update Now</button>
                            <button class="notification-btn">Learn More</button>
                            <button class="notification-btn notification-btn--ghost">Later</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== Recent Activity Feed ========== -->
        <section class="activity-feed fade-in">
            <div class="section-header">
                <h2>
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    Recent Activity
                </h2>
            </div>
            <div class="activity-list" id="activity-list">
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fa-solid fa-info"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Admin dashboard initialized</div>
                        <div class="activity-time">Just now</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- ========== Footer ========== -->
    <footer class="admin-footer">
        © <span id="current-year"></span> Sweet Delights Bakery · Admin Dashboard ·
        <a href="index.html">Back to Store</a>
    </footer>

    <!-- ========== JavaScript ========== -->
    <script>
        (function () {
            'use strict';

            // ========== Configuration ==========
            const STORAGE_KEY = 'orders';
            const ORDER_STATUSES = ['Pending', 'Preparing', 'Ready', 'Out for Delivery', 'Delivered'];
            const HIGH_VALUE_THRESHOLD = 1200;
            
            // ========== State Management ==========
            const state = {
                search: '',
                highValueOnly: false,
                dateRange: 'all',
                lastMetrics: {}
            };
            
            let activeStatus = 'all';
            let orders = normalizeOrders(loadOrders());
            let activityLog = [];

            // ========== DOM Elements ==========
            const elements = {
                search: document.getElementById('admin-search'),
                statusButtons: Array.from(document.querySelectorAll('[data-status-filter]')),
                highValueToggle: document.getElementById('high-value-toggle'),
                dateFilter: document.getElementById('date-filter'),
                orderList: document.getElementById('order-list'),
                orderCount: document.getElementById('order-count'),
                refreshBtn: document.getElementById('refresh-data'),
                exportBtn: document.getElementById('export-orders'),
                clearBtn: document.getElementById('clear-orders'),
                activityList: document.getElementById('activity-list'),
                chartPeriod: document.getElementById('chart-period'),
                salesChart: document.getElementById('sales-chart'),
                // Metrics
                totalOrders: document.querySelector('[data-metric="orders"]'),
                openOrders: document.querySelector('[data-metric="open"]'),
                revenueTotal: document.querySelector('[data-metric="revenue"]'),
                averageValue: document.querySelector('[data-metric="average"]'),
                topSeller: document.querySelector('[data-metric="top-seller"]'),
                todayOrders: document.querySelector('[data-metric="today"]'),
                deliveredOrders: document.querySelector('[data-metric="delivered"]'),
                inProgressOrders: document.querySelector('[data-metric="in-progress"]'),
                productsSold: document.querySelector('[data-metric="products-sold"]'),
                fulfillmentTime: document.querySelector('[data-metric="fulfillment-time"]')
            };

            // ========== Initialization ==========
            document.getElementById('current-year').textContent = new Date().getFullYear();
            bindEvents();
            refresh();
            initializeCharts();
            logActivity('Admin dashboard loaded', 'info');

            // ========== Event Bindings ==========
            function bindEvents() {
                if (elements.search) {
                    elements.search.addEventListener('input', event => {
                        state.search = event.target.value.trim().toLowerCase();
                        refresh();
                    });
                }

                elements.statusButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        activeStatus = button.dataset.statusFilter;
                        updateStatusButtons();
                        refresh();
                        logActivity(`Filtered by status: ${activeStatus}`, 'filter');
                    });
                });

                if (elements.highValueToggle) {
                    elements.highValueToggle.addEventListener('change', event => {
                        state.highValueOnly = event.target.checked;
                        refresh();
                        logActivity(`High value filter: ${event.target.checked ? 'ON' : 'OFF'}`, 'filter');
                    });
                }

                if (elements.dateFilter) {
                    elements.dateFilter.addEventListener('change', event => {
                        state.dateRange = event.target.value;
                        refresh();
                        logActivity(`Date range changed: ${event.target.value}`, 'filter');
                    });
                }

                if (elements.refreshBtn) {
                    elements.refreshBtn.addEventListener('click', () => {
                        orders = normalizeOrders(loadOrders());
                        refresh();
                        logActivity('Data refreshed', 'info');
                        showNotification('Data refreshed successfully!');
                    });
                }

                if (elements.exportBtn) {
                    elements.exportBtn.addEventListener('click', exportOrders);
                }

                if (elements.clearBtn) {
                    elements.clearBtn.addEventListener('click', clearOrders);
                }

                if (elements.chartPeriod) {
                    elements.chartPeriod.addEventListener('change', () => {
                        updateSalesChart();
                    });
                }

                if (elements.orderList) {
                    elements.orderList.addEventListener('change', event => {
                        if (event.target.matches('.order-status-select')) {
                            const oldStatus = event.target.dataset.oldStatus;
                            const newStatus = event.target.value;
                            updateOrderStatus(event.target.dataset.orderId, newStatus);
                            logActivity(`Order ${event.target.dataset.orderId} status: ${oldStatus} → ${newStatus}`, 'update');
                        }
                    });

                    elements.orderList.addEventListener('input', event => {
                        if (event.target.matches('.order-note-input')) {
                            updateOrderNote(event.target.dataset.orderId, event.target.value);
                        }
                    });

                    elements.orderList.addEventListener('click', event => {
                        if (event.target.matches('.copy-details') || event.target.closest('.copy-details')) {
                            const button = event.target.matches('.copy-details') ? event.target : event.target.closest('.copy-details');
                            copyShippingDetails(button.dataset.orderId, button);
                        }
                    });
                }

                // Listen for storage changes (orders from storefront)
                window.addEventListener('storage', event => {
                    if (event.key === STORAGE_KEY) {
                        orders = normalizeOrders(loadOrders());
                        refresh();
                        logActivity('New order received from storefront', 'success');
                    }
                });
            }

            // ========== Main Refresh Function ==========
            function refresh() {
                const filteredOrders = applyFilters();
                renderMetrics();
                renderOrders(filteredOrders);
                updateOrderCount(filteredOrders.length);
                updateSalesChart();
                document.title = `Admin · ${orders.length} orders`;
            }

            // ========== Data Loading ==========
            function loadOrders() {
                try {
                    const stored = JSON.parse(localStorage.getItem(STORAGE_KEY));
                    return Array.isArray(stored) ? stored : [];
                } catch (error) {
                    console.warn('Unable to parse saved orders:', error);
                    return [];
                }
            }

            function normalizeOrders(rawOrders) {
                let mutated = false;
                const normalized = rawOrders.map(order => {
                    const current = { ...order };
                    if (!current.status) {
                        current.status = 'Pending';
                        mutated = true;
                    }
                    if (typeof current.note !== 'string') {
                        current.note = '';
                        mutated = true;
                    }
                    if (!current.date) {
                        current.date = new Date().toISOString();
                        mutated = true;
                    }
                    return current;
                });
                if (mutated) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(normalized));
                }
                return normalized;
            }

            function saveOrders() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
            }

            // ========== Filtering ==========
            function applyFilters() {
                return orders.filter(order => {
                    const matchesStatus = activeStatus === 'all' || order.status === activeStatus;
                    const matchesHighValue = !state.highValueOnly || Number(order.total || 0) >= HIGH_VALUE_THRESHOLD;
                    const matchesSearch = state.search === '' || [
                        order.id,
                        order.phone,
                        order.address,
                        (order.items || []).map(item => item.name).join(' ')
                    ].some(field => typeof field === 'string' && field.toLowerCase().includes(state.search));
                    const matchesDate = checkDate(order.date);
                    return matchesStatus && matchesHighValue && matchesSearch && matchesDate;
                });
            }

            function checkDate(dateValue) {
                if (state.dateRange === 'all') return true;
                const orderDate = new Date(dateValue);
                if (Number.isNaN(orderDate.getTime())) return false;
                const now = new Date();
                const diff = (now - orderDate) / (1000 * 60 * 60 * 24);
                
                if (state.dateRange === 'today') {
                    return orderDate.toDateString() === now.toDateString();
                }
                if (state.dateRange === '7') {
                    return diff <= 7;
                }
                if (state.dateRange === '30') {
                    return diff <= 30;
                }
                if (state.dateRange === '90') {
                    return diff <= 90;
                }
                return true;
            }

            // ========== Metrics Rendering ==========
            function renderMetrics() {
                const totalOrders = orders.length;
                const openOrders = orders.filter(order => order.status !== 'Delivered').length;
                const deliveredOrders = orders.filter(order => order.status === 'Delivered').length;
                const inProgressOrders = orders.filter(order => 
                    order.status === 'Preparing' || order.status === 'Ready' || order.status === 'Out for Delivery'
                ).length;
                const revenue = orders.reduce((sum, order) => sum + Number(order.total || 0), 0);
                const average = totalOrders ? revenue / totalOrders : 0;
                const topProduct = calculateTopSeller() || '—';
                const todayOrders = orders.filter(order => {
                    const orderDate = new Date(order.date);
                    const today = new Date();
                    return orderDate.toDateString() === today.toDateString();
                }).length;
                const productsSold = orders.reduce((sum, order) => {
                    return sum + (order.items || []).reduce((itemSum, item) => itemSum + Number(item.quantity || 0), 0);
                }, 0);

                // Update metrics
                if (elements.totalOrders) elements.totalOrders.textContent = totalOrders.toLocaleString('en-IN');
                if (elements.openOrders) elements.openOrders.textContent = openOrders.toLocaleString('en-IN');
                if (elements.revenueTotal) elements.revenueTotal.textContent = `₹${formatCurrency(revenue)}`;
                if (elements.averageValue) elements.averageValue.textContent = `₹${formatCurrency(average)}`;
                if (elements.topSeller) elements.topSeller.textContent = topProduct;
                if (elements.todayOrders) elements.todayOrders.textContent = todayOrders.toLocaleString('en-IN');
                if (elements.deliveredOrders) elements.deliveredOrders.textContent = deliveredOrders.toLocaleString('en-IN');
                if (elements.inProgressOrders) elements.inProgressOrders.textContent = inProgressOrders.toLocaleString('en-IN');
                if (elements.productsSold) elements.productsSold.textContent = productsSold.toLocaleString('en-IN');
                
                // Calculate fulfillment time (mock for now)
                if (elements.fulfillmentTime) {
                    elements.fulfillmentTime.textContent = deliveredOrders > 0 ? '2.5 hrs' : '—';
                }

                // Update change indicators
                updateMetricChanges({
                    orders: totalOrders,
                    open: openOrders,
                    revenue: revenue,
                    average: average,
                    today: todayOrders
                });
            }

            function updateMetricChanges(currentMetrics) {
                const changes = {
                    orders: calculateChange(state.lastMetrics.orders, currentMetrics.orders),
                    open: calculateChange(state.lastMetrics.open, currentMetrics.open),
                    revenue: calculateChange(state.lastMetrics.revenue, currentMetrics.revenue),
                    average: calculateChange(state.lastMetrics.average, currentMetrics.average),
                    today: calculateChange(state.lastMetrics.today, currentMetrics.today)
                };

                // Update change displays
                Object.keys(changes).forEach(key => {
                    const element = document.querySelector(`[data-metric="${key}-change"]`);
                    if (element && changes[key] !== null) {
                        const change = changes[key];
                        if (change > 0) {
                            element.className = 'metric-change metric-change--positive';
                            element.innerHTML = `<i class="fa-solid fa-arrow-up"></i> +${change}%`;
                        } else if (change < 0) {
                            element.className = 'metric-change metric-change--negative';
                            element.innerHTML = `<i class="fa-solid fa-arrow-down"></i> ${change}%`;
                        } else {
                            element.className = 'metric-change metric-change--neutral';
                            element.innerHTML = `<i class="fa-solid fa-minus"></i> No change`;
                        }
                    }
                });

                state.lastMetrics = currentMetrics;
            }

            function calculateChange(oldValue, newValue) {
                if (oldValue === undefined || oldValue === null || oldValue === 0) return null;
                return Math.round(((newValue - oldValue) / oldValue) * 100);
            }

            function calculateTopSeller() {
                const counts = new Map();
                orders.forEach(order => {
                    (order.items || []).forEach(item => {
                        const quantity = Number(item.quantity || 0);
                        counts.set(item.name, (counts.get(item.name) || 0) + quantity);
                    });
                });
                if (!counts.size) return null;
                return [...counts.entries()].sort((a, b) => b[1] - a[1])[0][0];
            }

            // ========== Orders Rendering ==========
            function renderOrders(list) {
                if (!elements.orderList) return;
                if (!list.length) {
                    elements.orderList.classList.add('order-list--empty');
                    elements.orderList.innerHTML = `
                        <div class="empty-state">
                            <i class="fa-solid fa-cookie-bite" aria-hidden="true"></i>
                            <p>No orders match the current filters</p>
                            <p class="hint">Adjust filters or collect new orders from the storefront.</p>
                        </div>
                    `;
                    return;
                }
                elements.orderList.classList.remove('order-list--empty');
                elements.orderList.innerHTML = list.map(order => createOrderMarkup(order)).join('');
            }

            function createOrderMarkup(order) {
                const items = (order.items || []).map(item => `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.quantity}</td>
                        <td>₹${formatCurrency(item.price)}</td>
                        <td><strong>₹${formatCurrency((item.price || 0) * (item.quantity || 0))}</strong></td>
                    </tr>
                `).join('');

                return `
                    <article class="order-card fade-in" data-status="${order.status}">
                        <header class="order-card__header">
                            <div>
                                <h3>Order #${order.id}</h3>
                                <p class="order-meta">
                                    <i class="fa-solid fa-clock"></i>
                                    ${formatDate(order.date)}
                                </p>
                            </div>
                            <div class="order-status">
                                <span class="status-pill" data-status="${order.status}">${order.status}</span>
                                <span class="status-label">Update Status</span>
                                <select class="order-status-select" data-order-id="${order.id}" data-old-status="${order.status}">
                                    ${createStatusOptions(order.status)}
                                </select>
                            </div>
                        </header>
                        <div class="order-card__body">
                            <table class="item-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>Price</th>
                                        <th>Line Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${items}
                                </tbody>
                            </table>
                            <dl class="order-details">
                                <div>
                                    <dt>Order Total</dt>
                                    <dd><strong>₹${formatCurrency(order.total)}</strong></dd>
                                </div>
                                <div>
                                    <dt>Customer Phone</dt>
                                    <dd>${order.phone}</dd>
                                </div>
                                <div>
                                    <dt>Delivery Address</dt>
                                    <dd>${order.address}</dd>
                                </div>
                            </dl>
                        </div>
                        <footer class="order-card__footer">
                            <label class="note-label">
                                <i class="fa-solid fa-note-sticky"></i>
                                Admin Notes
                            </label>
                            <textarea class="order-note-input" data-order-id="${order.id}" placeholder="Add reminders, special instructions, or follow-up tasks...">${order.note || ''}</textarea>
                            <div class="card-actions">
                                <button type="button" class="ghost-button copy-details" data-order-id="${order.id}">
                                    <i class="fa-regular fa-copy" aria-hidden="true"></i>
                                    Copy Shipping Details
                                </button>
                                <button type="button" class="ghost-button" onclick="window.print()">
                                    <i class="fa-solid fa-print" aria-hidden="true"></i>
                                    Print Order
                                </button>
                            </div>
                        </footer>
                    </article>
                `;
            }

            function createStatusOptions(selected) {
                return ORDER_STATUSES.map(status => `
                    <option value="${status}" ${status === selected ? 'selected' : ''}>${status}</option>
                `).join('');
            }

            // ========== Order Actions ==========
            function updateOrderStatus(orderId, newStatus) {
                orders = orders.map(order => order.id === orderId ? { ...order, status: newStatus } : order);
                saveOrders();
                refresh();
            }

            function updateOrderNote(orderId, noteValue) {
                orders = orders.map(order => order.id === orderId ? { ...order, note: noteValue } : order);
                saveOrders();
            }

            function copyShippingDetails(orderId, trigger) {
                const order = orders.find(entry => entry.id === orderId);
                if (!order) return;
                const lines = [
                    `Order #${order.id}`,
                    `Phone: ${order.phone}`,
                    `Address: ${order.address}`,
                    `Total: ₹${formatCurrency(order.total)}`,
                    `Status: ${order.status}`
                ];
                const text = lines.join('\n');
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopiedState(trigger);
                        logActivity(`Copied details for Order #${orderId}`, 'action');
                    }).catch(() => fallbackCopy(text, trigger));
                } else {
                    fallbackCopy(text, trigger);
                }
            }

            function fallbackCopy(text, trigger) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.setAttribute('readonly', '');
                textarea.style.position = 'absolute';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showCopiedState(trigger);
                } catch (error) {
                    alert('Copy not supported in this browser. Please copy manually.');
                } finally {
                    document.body.removeChild(textarea);
                }
            }

            function showCopiedState(button) {
                if (!button) return;
                const original = button.innerHTML;
                button.classList.add('ghost-button--success');
                button.innerHTML = '<i class="fa-solid fa-check" aria-hidden="true"></i> Copied!';
                setTimeout(() => {
                    button.classList.remove('ghost-button--success');
                    button.innerHTML = original;
                }, 1500);
            }

            // ========== Export & Clear ==========
            function exportOrders() {
                if (!orders.length) {
                    alert('No orders available to export yet.');
                    return;
                }
                const header = ['Order ID', 'Date', 'Status', 'Phone', 'Address', 'Item', 'Quantity', 'Price', 'Line Total', 'Order Total', 'Notes'];
                const rows = orders.flatMap(order => {
                    return (order.items || []).map((item, index) => [
                        wrapCsv(order.id),
                        wrapCsv(formatDate(order.date)),
                        wrapCsv(order.status),
                        wrapCsv(order.phone),
                        wrapCsv(order.address),
                        wrapCsv(item.name),
                        wrapCsv(item.quantity),
                        wrapCsv(formatCurrency(item.price)),
                        wrapCsv(formatCurrency((item.price || 0) * (item.quantity || 0))),
                        index === 0 ? wrapCsv(formatCurrency(order.total)) : '""',
                        index === 0 ? wrapCsv(order.note || '') : '""'
                    ].join(','));
                });
                const csv = [header.join(','), ...rows].join('\n');
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sweet-delights-orders-${new Date().toISOString().slice(0, 10)}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                logActivity(`Exported ${orders.length} orders to CSV`, 'success');
                showNotification('Orders exported successfully!');
            }

            function wrapCsv(value) {
                if (value === undefined || value === null) return '""';
                const stringValue = String(value).replace(/"/g, '""');
                return `"${stringValue}"`;
            }

            function clearOrders() {
                if (!orders.length) {
                    alert('There are no orders stored in this browser.');
                    return;
                }
                const confirmed = confirm(`This will permanently remove all ${orders.length} saved orders from this browser. This action cannot be undone. Continue?`);
                if (!confirmed) return;
                orders = [];
                saveOrders();
                refresh();
                logActivity('All orders cleared', 'warning');
                showNotification('All orders have been cleared.');
            }

            // ========== UI Updates ==========
            function updateOrderCount(count) {
                if (elements.orderCount) {
                    elements.orderCount.textContent = `${count} ${count === 1 ? 'order' : 'orders'}`;
                }
            }

            function updateStatusButtons() {
                elements.statusButtons.forEach(button => {
                    if (button.dataset.statusFilter === activeStatus) {
                        button.classList.add('chip--active');
                    } else {
                        button.classList.remove('chip--active');
                    }
                });
            }

            // ========== Charts ==========
            function initializeCharts() {
                updateSalesChart();
            }

            function updateSalesChart() {
                if (!elements.salesChart) return;
                
                const period = parseInt(elements.chartPeriod?.value || '7');
                const salesData = generateSalesData(period);
                
                if (salesData.every(d => d.value === 0)) {
                    elements.salesChart.innerHTML = `
                        <div class="chart-placeholder">
                            <i class="fa-solid fa-chart-simple"></i>
                            <p>No sales data available yet</p>
                        </div>
                    `;
                    return;
                }

                const maxValue = Math.max(...salesData.map(d => d.value), 1);
                const barsHtml = salesData.map(data => {
                    const height = (data.value / maxValue) * 100;
                    return `
                        <div class="bar-chart-item">
                            <div class="bar" style="height: ${height}%">
                                <span class="bar-value">₹${formatCurrency(data.value)}</span>
                            </div>
                            <span class="bar-label">${data.label}</span>
                        </div>
                    `;
                }).join('');

                elements.salesChart.innerHTML = `<div class="bar-chart">${barsHtml}</div>`;
            }

            function generateSalesData(days) {
                const data = [];
                const now = new Date();
                
                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toDateString();
                    
                    const dayOrders = orders.filter(order => {
                        const orderDate = new Date(order.date);
                        return orderDate.toDateString() === dateStr;
                    });
                    
                    const dayRevenue = dayOrders.reduce((sum, order) => sum + Number(order.total || 0), 0);
                    
                    data.push({
                        label: date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' }),
                        value: dayRevenue
                    });
                }
                
                return data;
            }

            // ========== Activity Log ==========
            function logActivity(message, type = 'info') {
                const activity = {
                    message,
                    type,
                    time: new Date()
                };
                activityLog.unshift(activity);
                activityLog = activityLog.slice(0, 10); // Keep last 10
                renderActivityLog();
            }

            function renderActivityLog() {
                if (!elements.activityList) return;
                
                const icons = {
                    info: 'fa-info-circle',
                    success: 'fa-check-circle',
                    warning: 'fa-exclamation-triangle',
                    error: 'fa-times-circle',
                    filter: 'fa-filter',
                    update: 'fa-sync',
                    action: 'fa-bolt'
                };

                elements.activityList.innerHTML = activityLog.map(activity => `
                    <div class="activity-item slide-in">
                        <div class="activity-icon">
                            <i class="fa-solid ${icons[activity.type] || icons.info}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.message}</div>
                            <div class="activity-time">${formatTimeAgo(activity.time)}</div>
                        </div>
                    </div>
                `).join('');
            }

            // ========== Utilities ==========
            function formatDate(value) {
                const date = new Date(value);
                if (Number.isNaN(date.getTime())) return 'Unknown date';
                return date.toLocaleString('en-IN', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function formatTimeAgo(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                if (seconds < 60) return 'Just now';
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                const days = Math.floor(hours / 24);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }

            function formatCurrency(value) {
                const number = Number(value || 0);
                return number.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }

            function showNotification(message) {
                // Simple notification - can be enhanced with a toast library
                console.log('Notification:', message);
            }

            // ========== Quick Action Helper ==========
            window.filterByStatus = function(status) {
                activeStatus = status;
                updateStatusButtons();
                refresh();
                logActivity(`Quick filter applied: ${status}`, 'filter');
            };

                // ========== New Features Handlers ==========
                // Notifications - Mark All Readq
            const markAllReadBtn = document.getElementById('mark-all-read');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', () => {
                    document.querySelectorAll('.notification-card').forEach(card => {
                        card.classList.add('notification-card--read');
                    });
                    const badge = document.querySelector('.section-badge--pulse');
                    if (badge) badge.textContent = '0';
                    logActivity('All notifications marked as read', 'action');
                    showNotification('All notifications marked as read!');
                });
            }

            // Notifications - Settings
            const notificationSettingsBtn = document.getElementById('notification-settings');
            if (notificationSettingsBtn) {
                notificationSettingsBtn.addEventListener('click', () => {
                    alert('Notification Settings\n\nTo be implemented:\n- Email notifications\n- SMS alerts\n- Custom thresholds\n- Alert preferences');
                    logActivity('Opened notification settings', 'action');
                });
            }

            // Notification Action Buttons
            document.addEventListener('click', (e) => {
                if (e.target.closest('.notification-btn--ghost') && e.target.textContent === 'Dismiss') {
                    const card = e.target.closest('.notification-card');
                    if (card) {
                        card.style.animation = 'slideOut 0.3s ease forwards';
                        setTimeout(() => card.remove(), 300);
                        logActivity('Notification dismissed', 'action');
                    }
                }
            });
            
            // Dashboard - Add Inventory Item
            const addInventoryBtn = document.getElementById('add-inventory-item');
            if (addInventoryBtn) {
                addInventoryBtn.addEventListener('click', () => {
                    alert('Add Inventory Item functionality - To be implemented!\n\nYou can add:\n- Product name\n- Current stock\n- Reorder level\n- Category');
                    logActivity('Attempted to add new inventory item', 'action');
                });
            }

            // Inventory - Update Stock buttons
            document.addEventListener('click', (e) => {
                if (e.target.textContent === 'Update Stock') {
                    const card = e.target.closest('.inventory-card');
                    const itemName = card.querySelector('.inventory-name').textContent;
                    alert(`Update Stock for ${itemName}\n\nTo be implemented:\n- Adjust quantity\n- Add/Remove stock\n- Track history`);
                    logActivity(`Stock update requested for ${itemName}`, 'action');
                }
                
                if (e.target.textContent === 'View History') {
                    const card = e.target.closest('.inventory-card');
                    const itemName = card.querySelector('.inventory-name').textContent;
                    alert(`Stock History for ${itemName}\n\nTo be implemented:\n- Show stock movements\n- Date/time stamps\n- User who made changes`);
                    logActivity(`Viewed history for ${itemName}`, 'info');
                }
                
                if (e.target.textContent === 'Reorder Now') {
                    const card = e.target.closest('.inventory-card');
                    const itemName = card.querySelector('.inventory-name').textContent;
                    alert(`Reorder ${itemName}\n\nTo be implemented:\n- Send reorder notification\n- Track supplier\n- Generate purchase order`);
                    logActivity(`Reorder triggered for ${itemName}`, 'warning');
                }
            });

            // Customer Insights - Calculate from orders
            function updateCustomerInsights() {
                const customerData = {};
                
                orders.forEach(order => {
                    const phone = order.phone || 'Unknown';
                    if (!customerData[phone]) {
                        customerData[phone] = {
                            phone: phone,
                            name: order.customerName || 'Guest',
                            orders: 0,
                            totalSpent: 0,
                            lastOrder: order.timestamp
                        };
                    }
                    customerData[phone].orders++;
                    customerData[phone].totalSpent += parseFloat(order.total || 0);
                    if (order.timestamp > customerData[phone].lastOrder) {
                        customerData[phone].lastOrder = order.timestamp;
                    }
                });
                
                const customers = Object.values(customerData);
                const totalCustomers = customers.length;
                const repeatCustomers = customers.filter(c => c.orders > 1).length;
                const avgCustomerValue = totalCustomers > 0 ? 
                    customers.reduce((sum, c) => sum + c.totalSpent, 0) / totalCustomers : 0;
                const topCustomer = customers.sort((a, b) => b.orders - a.orders)[0];
                
                // Update metrics
                const totalCustomersEl = document.querySelector('[data-metric=\"total-customers\"]');
                if (totalCustomersEl) totalCustomersEl.textContent = totalCustomers;
                
                const repeatCustomersEl = document.querySelector('[data-metric=\"repeat-customers\"]');
                if (repeatCustomersEl) repeatCustomersEl.textContent = repeatCustomers;
                
                const customerLtvEl = document.querySelector('[data-metric=\"customer-ltv\"]');
                if (customerLtvEl) customerLtvEl.textContent = '₹' + formatCurrency(avgCustomerValue);
                
                const topCustomerEl = document.querySelector('[data-metric=\"top-customer\"]');
                if (topCustomerEl && topCustomer) {
                    topCustomerEl.textContent = `${topCustomer.name} (${topCustomer.orders} orders)`;
                }
                
                // Update customer table
                updateCustomerTable(customers.slice(0, 10)); // Show top 10
            }
            
            function updateCustomerTable(customers) {
                const tbody = document.getElementById('customer-table-body');
                if (!tbody) return;
                
                if (customers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-row">
                                <i class="fa-solid fa-users"></i>
                                <p>Customer data will appear here</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = customers.map((customer, idx) => {
                    const status = customer.orders > 5 ? 'VIP' : customer.orders > 2 ? 'Regular' : 'New';
                    const statusClass = customer.orders > 5 ? 'status-success' : 
                                       customer.orders > 2 ? 'status-warning' : 'status-info';
                    return `
                        <tr>
                            <td>${customer.name}</td>
                            <td>${customer.phone}</td>
                            <td>${customer.orders}</td>
                            <td>₹${formatCurrency(customer.totalSpent)}</td>
                            <td>${formatDate(customer.lastOrder)}</td>
                            <td><span class="chip ${statusClass}">${status}</span></td>
                        </tr>
                    `;
                }).join('');
            }

            // Update customer insights on refresh
            const originalRefresh = refresh;
            refresh = function() {
                originalRefresh();
                updateCustomerInsights();
            };

            // Initial customer insights update
            updateCustomerInsights();

            // ========== Auto Refresh ==========
            setInterval(() => {
                const newOrders = normalizeOrders(loadOrders());
                if (newOrders.length !== orders.length) {
                    orders = newOrders;
                    refresh();
                    logActivity('New order detected - auto-refreshed', 'success');
                }
            }, 5000); // Check every 5 seconds

        })();
    </script>
</body>
</html>
